import os
import json
import sys
try:
    from aceinna.devices.parsers.open_packet_parser import match_command_handler
except:  # pylint: disable=bare-except
    sys.path.append('./src')
    from aceinna.devices.parsers.open_packet_parser import match_command_handler


APP_NAME = 'IMU'
APP_FILE_PATH = os.path.join(
    os.getcwd(), 'setting', 'openimu', APP_NAME, 'openimu.json')
PROPERTIES = None
with open(APP_FILE_PATH) as json_data:
    PROPERTIES = json.load(json_data)


def parse_data(packet_type, payload):
    parser = match_command_handler(packet_type)
    return parser(payload, PROPERTIES['userConfiguration'])


if __name__ == '__main__':
    data = [
        0x55, 0x55, 0x67, 0x41, 0x80, 0xC7, 0x9A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC2, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x73, 0x31, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2B, 0x58, 0x2B, 0x59, 0x2B, 0x5A, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6B, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x25, 0x4B
    ]
    print(parse_data('gA', data))
